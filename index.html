<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <!-- スマホでの表示に必須の設定（拡大縮小の無効化など） -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>スマホでテトリス</title>
    <style>
        /* 全体のスタイル設定 */
        body {
            margin: 0;
            padding: 0;
            background-color: #202028; /* 暗めの背景色 */
            color: #fff;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            height: 100vh; /* 画面いっぱいに使う */
            touch-action: none; /* ダブルタップなどによるズームを禁止 */
            overflow: hidden; /* スクロール禁止 */
        }

        /* ヘッダー（スコア表示エリア） */
        header {
            width: 100%;
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
            background-color: #333;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .score-box {
            text-align: center;
        }

        .label {
            font-size: 0.8rem;
            color: #aaa;
        }

        /* ゲーム画面（キャンバス）のコンテナ */
        #game-container {
            flex-grow: 1; /* 余ったスペースを埋める */
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
        }

        canvas {
            background-color: #000;
            border: 2px solid #555;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            /* JSでサイズ制御しますが、最大幅を一応制限 */
            max-width: 100%; 
            max-height: 100%;
        }

        /* コントローラーエリア */
        #controls {
            width: 100%;
            padding-bottom: 20px; /* 下部の余白 */
            background-color: #2a2a35;
        }

        /* ボタンの並び */
        .button-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }

        /* ボタン共通スタイル */
        .btn {
            width: 70px;
            height: 70px;
            background-color: #444;
            border-radius: 50%; /* 丸いボタン */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            user-select: none; /* テキスト選択禁止 */
            cursor: pointer;
            box-shadow: 0 4px 0 #222; /* 立体感 */
            transition: transform 0.1s;
        }

        .btn:active {
            transform: translateY(4px); /* 押した時に凹む */
            box-shadow: none;
            background-color: #666;
        }

        /* 回転ボタンを目立たせる */
        .btn-rotate {
            background-color: #d32f2f; /* 赤系 */
            box-shadow: 0 4px 0 #8e0000;
        }
        .btn-rotate:active {
            background-color: #f44336;
        }

        /* 落下ボタン */
        .btn-drop {
            width: 160px; /* 横長 */
            border-radius: 35px;
        }

    </style>
</head>
<body>

    <!-- ヘッダー -->
    <header>
        <div class="score-box">
            <div class="label">SCORE</div>
            <div id="score">0</div>
        </div>
        <div class="score-box">
            <div class="label">LEVEL</div>
            <div id="level">1</div>
        </div>
    </header>

    <!-- キャンバス -->
    <div id="game-container">
        <canvas id="tetris"></canvas>
    </div>

    <!-- コントローラー -->
    <div id="controls">
        <div class="button-row">
            <div class="btn btn-rotate" id="btn-rotate">↻</div>
        </div>
        <div class="button-row">
            <div class="btn" id="btn-left">←</div>
            <div class="btn btn-drop" id="btn-drop">↓</div>
            <div class="btn" id="btn-right">→</div>
        </div>
    </div>

    <script>
        // --- 設定定数 ---
        const COLS = 10;
        const ROWS = 20;
        const BLOCK_SIZE = 30; // 基準サイズ（後でリサイズ時に計算し直す）

        // --- DOM要素の取得 ---
        const canvas = document.getElementById('tetris');
        const ctx = canvas.getContext('2d');
        const gameContainer = document.getElementById('game-container');

        // --- 変数 ---
        let scale = 1; // 描画スケール

        // --- 初期化処理 ---
        function init() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // ボタンのイベントリスナー（動作確認用ログ）
            document.getElementById('btn-left').addEventListener('touchstart', (e) => handleInput(e, 'LEFT'));
            document.getElementById('btn-right').addEventListener('touchstart', (e) => handleInput(e, 'RIGHT'));
            document.getElementById('btn-rotate').addEventListener('touchstart', (e) => handleInput(e, 'ROTATE'));
            document.getElementById('btn-drop').addEventListener('touchstart', (e) => handleInput(e, 'DROP'));
            
            // PCでのデバッグ用にクリックイベントも追加
            document.getElementById('btn-left').addEventListener('click', () => console.log("Left Clicked"));

            // 最初の描画
            draw();
        }

        // --- レスポンシブ対応: キャンバスのリサイズ ---
        function resizeCanvas() {
            // コンテナの大きさを取得
            const containerWidth = gameContainer.clientWidth;
            const containerHeight = gameContainer.clientHeight;

            // 縦横比を保ちつつ最大サイズを計算
            // テトリス盤面は 1:2 の比率
            const aspectRatio = COLS / ROWS;
            
            let newWidth = containerWidth;
            let newHeight = newWidth / aspectRatio;

            if (newHeight > containerHeight) {
                newHeight = containerHeight;
                newWidth = newHeight * aspectRatio;
            }

            // 少し余白を持たせる
            newWidth *= 0.95;
            newHeight *= 0.95;

            // 高解像度ディスプレイ対応 (devicePixelRatio)
            const dpr = window.devicePixelRatio || 1;
            
            // キャンバスの内部解像度を設定
            canvas.width = newWidth * dpr;
            canvas.height = newHeight * dpr;

            // CSSでの表示サイズを設定
            canvas.style.width = `${newWidth}px`;
            canvas.style.height = `${newHeight}px`;

            // コンテキストのスケール調整
            ctx.scale(dpr, dpr);

            // ブロック1マスのサイズを計算して保存
            scale = newWidth / COLS;

            // 再描画
            draw();
        }

        // --- 描画処理 ---
        function draw() {
            // 背景クリア
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, COLS * scale, ROWS * scale);

            // グリッド（マス目）を描画
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;

            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    ctx.strokeRect(c * scale, r * scale, scale, scale);
                }
            }

            // 動作確認用：中央にテスト用ブロックを描画してみる
            drawBlock(4, 10, 'cyan');
            drawBlock(5, 10, 'cyan');
            drawBlock(6, 10, 'cyan');
            drawBlock(5, 9, 'cyan');
        }

        // --- 1マスを描画する関数 ---
        function drawBlock(x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x * scale, y * scale, scale, scale);
            
            // ブロックに立体感をつける枠線
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 1;
            ctx.strokeRect(x * scale, y * scale, scale, scale);
        }

        // --- 入力処理 ---
        function handleInput(e, type) {
            // タッチイベントのデフォルト動作（スクロールなど）を防ぐ
            if(e.cancelable) e.preventDefault();
            console.log("Input:", type);
            // ここに後で移動ロジックを追加します
        }

        // 開始
        init();

    </script>
</body>
</html>

